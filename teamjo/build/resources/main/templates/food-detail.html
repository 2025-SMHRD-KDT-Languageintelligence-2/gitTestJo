<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title th:text="${food.name} + ' ìƒì„¸ì •ë³´'">ìŒì‹ ìƒì„¸ ì •ë³´</title>
  <link rel="stylesheet" href="/css/food-detail.css" />
</head>
<body>
  <div class="container">
    <h2 th:text="${food.name} + ' ìƒì„¸ ì •ë³´'">ìŒì‹ ìƒì„¸ ì •ë³´</h2>
    <img th:src="@{${food.img}}" alt="ìŒì‹ ì´ë¯¸ì§€" class="food-img" />

    <ul>
      <li><strong>ìœ í˜•:</strong> <span th:text="${food.type}"></span></li>
      <li><strong>íƒœê·¸:</strong> <span th:text="${food.nutr}"></span></li>
      <li><strong>ì´ì¹¼ë¡œë¦¬:</strong> <span th:text="${food.energy}"></span> kcal</li>
      <li><strong>ë‹¨ë°±ì§ˆ:</strong> <span th:text="${food.protein}"></span> g</li>
      <li><strong>ì§€ë°©:</strong> <span th:text="${food.province}"></span> g</li>
      <li><strong>íƒ„ìˆ˜í™”ë¬¼:</strong> <span th:text="${food.carbo}"></span> g</li>
      <li><strong>ë‹¹:</strong> <span th:text="${food.sugar}"></span> g</li>
      <li><strong>ë‚˜íŠ¸ë¥¨:</strong> <span th:text="${food.sodium}"></span> mg</li>
      <li><strong>ì½œë ˆìŠ¤í…Œë¡¤:</strong> <span th:text="${food.col}"></span> mg</li>
      <li><strong>í¬í™”ì§€ë°©:</strong> <span th:text="${food.sat}"></span> g</li>
      <li><strong>íŠ¸ëœìŠ¤ì§€ë°©:</strong> <span th:text="${food.trans}"></span> g</li>
      <li><strong>ê°€ê²©:</strong> <span th:text="${food.price}"></span> ì›</li>
    </ul>

    <hr style="margin: 40px 0;" />

    <h3>ğŸ“¢ ì‚¬ìš©ì ë¦¬ë·°</h3>
    <div id="reviewArea"></div>
    <div id="pagination" style="text-align: center; margin-top: 20px;"></div>

    <div th:if="${reviews == null or reviews.isEmpty()}">
      <p>ì•„ì§ ì‘ì„±ëœ ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
    </div>

    <a href="/mypage">â† ë§ˆì´í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸°</a>
  </div>

  <!-- âœ… JSìš© ë¦¬ë·° ë°ì´í„° ë°”ì¸ë”© -->
  <script th:inline="javascript">
    const allReviews = [[${reviews}]];
  </script>

  <script>
    const reviewArea = document.getElementById("reviewArea");
    const pagination = document.getElementById("pagination");
    const perPage = 5;
    let currentPage = 1;

    function renderReviews(page) {
      reviewArea.innerHTML = "";
      const start = (page - 1) * perPage;
      const selected = allReviews.slice(start, start + perPage);

      selected.forEach(review => {
        const html = `
          <div style="margin-bottom: 25px;">
            â­ <strong>${review.fscore}</strong>ì 
            <p>${review.freview}</p>
            <p style="font-size: 13px; color: #888;">
              ì‘ì„±ì: ${review.uid} Â· ${new Date(review.createdAt).toLocaleDateString()}
            </p>
          </div>
        `;
        reviewArea.insertAdjacentHTML("beforeend", html);
      });

      renderPagination();
    }

    function renderPagination() {
      pagination.innerHTML = "";
      const totalPages = Math.ceil(allReviews.length / perPage);

      for (let i = 1; i <= totalPages; i++) {
        const pageBtn = document.createElement("button");
        pageBtn.innerText = i;
        pageBtn.style.margin = "0 5px";
        pageBtn.style.fontWeight = i === currentPage ? "bold" : "normal";
        pageBtn.onclick = () => {
          currentPage = i;
          renderReviews(i);
        };
        pagination.appendChild(pageBtn);
      }
    }

    console.log(allReviews[0]);

    if (allReviews.length > 0) {
      renderReviews(currentPage);
    }
  </script>
</body>
</html>
